events {}
http {
    server {
        listen 80;
        location / {
            
            # --- 1. Block SQL Injection (Enhanced) ---
            if ($query_string ~* "union.*select|select.*from|or.*1=1|--|\/\*") {
                return 403 "Blocked: SQL Injection Attempt";
            }            

            # --- 2. Block XSS (Significantly Enhanced) ---
            if ($query_string ~* "(<|%3C).*script|javascript:|vbscript:|expression\(|onload=|onerror=|onmouseover=|onfocus=|onclick=|document\.cookie|\.alert\(") { 
                return 403 "Blocked: XSS Attempt"; 
            }
            
            # --- 3. Block Path Traversal ---
            if ($query_string ~* "\.\.[/\\\\]") { 
                return 403 "Blocked: Path Traversal"; 
            }
            
            # --- 4. Block SSRF ---
            if ($query_string ~* "localhost|127\.0\.0\.1|0\.0\.0\.0|\[::1\]") { 
                return 403 "Blocked: SSRF"; 
            }

            proxy_set_header X-WAF-Secret "MyPassword123";
            proxy_pass http://host.docker.internal:80/WAF/;
        }
    }
}