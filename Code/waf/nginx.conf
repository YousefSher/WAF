events {}
http {
    server {
        listen 80;
        location / {
            
                            # --- 1. Block SQL Injection (Enhanced) ---
                        # 1. union.*select      -> Matches standard union attacks
                # 2. (or|and).1.=.*1  -> Matches "OR 1=1", "AND 1=1" handling spaces/encoding
                # 3. (-|%2d){2,}        -> Matches "--" OR "%2D%2D" (The SQL Comment)
                # 4. (=|%3d)            -> Matches "=" OR "%3D"

                if ($query_string ~* "union.*select|select.*from|(or|and).*1(=|%3d)1|(-|%2d){2,}") {
                    return 403 "Blocked: SQL Injection Attempt";
            }

            # --- 2. Block XSS (Significantly Enhanced) ---
            if ($query_string ~* "(<|%3C).*script|javascript:|vbscript:|expression\(|onload=|onerror=|onmouseover=|onfocus=|onclick=|document\.cookie|\.alert\(") { 
                return 403 "Blocked: XSS Attempt"; 
            }
            
            # --- 3. Block Path Traversal ---
            if ($query_string ~* "\.\.[/\\\\]") { 
                return 403 "Blocked: Path Traversal"; 
            }
            
            # --- 4. Block SSRF ---
            if ($query_string ~* "localhost|127\.0\.0\.1|0\.0\.0\.0|\[::1\]") { 
                return 403 "Blocked: SSRF"; 
            }

            proxy_set_header X-WAF-Secret "MyPassword123";
            proxy_pass http://host.docker.internal:80/WAF/;
        }
    }
}